<!DOCTYPE html>
<meta charset="utf-8">
<style type="text/css">

rect:hover {
	fill: orange;
}

#tooltip {
	position: absolute;
	width: 200px;
	height: auto;
	padding: 10px;
	background-color: white;
	-webkit-border-radius: 10px;
	-moz-border-radius: 10px;
	border-radius: 10px;
	-webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
	-moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
	box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
	pointer-events: none;
}

#tooltip.hidden {
	display: none;
}

#tooltip p {
	margin: 0;
	font-family: sans-serif;
	font-size: 16px;
	line-height: 20px;
}

</style>

<body>
<div id="tooltip">
	<p><strong>Important Label Heading</strong></p>
	<p>Concept: <span id="id">100</span></p>
	<p>Thematic areas: <span id="thematic_areas">100</span>%</p>
	<p>Description: <span id="desc">100</span>%</p>
</div>

<link href="https://fonts.googleapis.com/css?family=Quicksand" rel="stylesheet" /><svg height="600" width="960"></svg>
<p><script src="https://d3js.org/d3.v4.min.js"></script><script src="http://d3js.org/queue.v1.min.js"></script>
<script>


function getBaseURL() {
    var url = location.href;  // entire url including querystring - also: window.location.href;
    var baseURL = url.substring(0, url.indexOf('/', 14));


    if (baseURL.indexOf('http://localhost') != -1) {
        // Base Url for localhost
        var url = location.href;  // window.location.href;
        var pathname = location.pathname;  // window.location.pathname;
        var index1 = url.indexOf(pathname);
        var index2 = url.indexOf("/", index1 + 1);
        var baseLocalUrl = url.substr(0, index2);

        return baseLocalUrl + "/";
    }
    else {
        // Root Url for domain name
        return baseURL + "/";
    }

}

var nodes_url = "https://api.myjson.com/bins/ig4ip";
var edges_url = "https://api.myjson.com/bins/o9qtd";
//var nodes_url = getBaseURL() + "/api/concepts/nodes";
//var edges_url = getBaseURL() + "/api/concepts/edges";

var marker = d3.select("svg").append('defs')
.append('marker')
.attr("id", "Triangle")
.attr("refX", 20)
.attr("refY", 6)
.attr("markerUnits", 'userSpaceOnUse')
.attr("markerWidth", 12)
.attr("markerHeight", 18)
.attr("orient", 'auto')
.append('path')
.attr("d", 'M 0 0 12 6 0 12 3 6');


var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");
    

var color = d3.scaleOrdinal(d3.schemeCategory20);

var simulation = d3.forceSimulation()
    .force("link", d3.forceLink().id(function(d) { return d.id; }))
    .force("charge", d3.forceManyBody().strength(-600).theta(0.4).distanceMin(25).distanceMax(100))
    .force("center", d3.forceCenter(width / 2, height / 2));
    
    
queue()
.defer(d3.json, nodes_url)
.defer(d3.json, edges_url)
.await(function(error, file1, file2) {createForceLayout(file1, file2); });

function createForceLayout (nodes, links) {
	
  //Draw links	
  var link = svg.append("g")
    .attr("class", "links")
    .selectAll("line")
    .data(links)
    .enter().append("line")
    .style("stroke", "black")
    .style("opacity", .5)
    .style("stroke-width", "2px");
    //.attr("stroke-width", function(d) { return Math.sqrt(d.value); });
  
  //Draw groups for nodes
  var node = svg.append("g")
    .attr("class", "nodes")
    .selectAll("concepts")
    .data(nodes)
    .enter()
    .append("g")
    .attr("class", "node");
  
  //Draw circles
  var circles = node.append("circle")
  .attr("r", 10)
  .style("fill", "lightgray")
  .style("stroke", "black")
  .style("stroke-width", "2px")
  .call(d3.drag()
    .on("start", dragstarted)
    .on("drag", dragged)
    .on("end", dragended));
    //.on("click", function() { window.open(getBaseURL() + "test"); });
    
  //Add onclick url to circles
  node.selectAll("circle").on("click", function(d) { window.open(getBaseURL() + d.url); });
    
  //Draw titles
  var titles = node.append("title")
  .text(function(d) {
    return d.id;
  });
  
  //Draw node text
  var text = node.append("text")
  .style("text-anchor", "middle")
  .attr("y", 25)
  .style("font-size", "15px")
  .style("font-weight", "bold")
  .style("font-family", "Quicksand")
  .text(function(d) {
    return d.id
  });

  //Draw markers  
  d3.selectAll("line").attr("marker-end", "url(#Triangle)");
  
  //d3.select("#tooltip").classed("hidden", true);
  
  //Events to display extra information on html
  svg.selectAll(".node")
  .on("mouseover", function(d,i) {
	  	var d = this.__data__;
	  	
		//Get this bar's x/y values, then augment for the tooltip
		//var xPosition = parseFloat(d3.select(this).attr("x")) + xScale.rangeBand() / 2;
		//var yPosition = parseFloat(d3.select(this).attr("y")) / 2 + h / 2;
		//Update the tooltip position and value
		d3.select("#tooltip")
			//.style("left", xPosition + "px")
			//.style("top", yPosition + "px")						
			.select("#id")
			.text(d.id);
   
		d3.select("#tooltip")
		//.style("left", xPosition + "px")
		//.style("top", yPosition + "px")						
		.select("#thematic_areas")
		.text(d.thematic_areas);
		
		d3.select("#tooltip")
		//.style("left", xPosition + "px")
		//.style("top", yPosition + "px")						
		.select("#desc")
		.text(d.desc);
		//Show the tooltip
		//d3.select("#tooltip").classed("hidden", false);
	  	
	  	/*var info = svg.append("g")
	     .attr("class", "info");
	  	
	  	 info.append("rect")
	  	 .attr("x", 10)
	  	 .attr("y", 10)
	  	 .attr("rx", 10)
	  	 .attr("ry", 10)
	  	 .attr("width", 250)
		 .attr("height", 550)
		 .style("fill", "transparent")
		 .style("stroke", "grey")
		 .style("stroke-width", "4"); 
	  	
	  	 info.append("text")
	  	 .attr("id", "tooltip")
	     .attr("x", 50)
	   	 .attr("y", 40)
	     .attr("height", 100)
	     .attr("width", 200)
	     .style("font-size", "15px")
  		 .style("font-weight", "bold")
 		 .style("font-family", "Quicksand")
 		 .text(d.id);
	  	 
	  	 info.append("text")
	  	 .attr("id", "tooltip")
	     .attr("x", 50)
	   	 .attr("y", 55)
	     .attr("height", 100)
	     .attr("width", 200)
	     .style("font-size", "8px")
 		 .style("font-family", "Quicksand")
 		 .text("(click the node to view all the information)");
	  	 
	  	 info.append("text")
	  	 .attr("id", "tooltip")
	     //.attr("x", 50)
	   	 .attr("y", 75)
	     .attr("height", 100)
	     .attr("width", 200)
	     .style("font-size", "13px")
  		 .style("font-weight", "bold")
 		 .style("font-family", "Quicksand")
  		 .tspans(function(h) {
        	return d3.wordwrap(d.thematic_areas, 25);  // break line after 25 characters
    		}).attr("x", 50);
//	     .text(d.thematic_areas);
	  	 
	  	 info.append("text")
    	 .attr("id", "tooltip")
	     //.attr("x", 120)
	   	 .attr("y", 120)
	     .attr("height", 100)
	     .attr("width", 200)
	     .style("font-size", "11px")
 		 .style("font-family", "Quicksand")
 		  		 .tspans(function(h) {
        	return d3.wordwrap(d.desc, 25);  // break line after 25 characters
    		}).attr("x", 50);
	     //.text(d.desc); //Pending to be wrapped

	  	 
	  	 info.append("text")
	  	 .attr("id", "tooltip")
	     .attr("x", 50)
	   	 .attr("y", 250)
	     .attr("height", 100)
	     .attr("width", 200)
	     .text(d.documents);*/
      });
  /*.on("mouseout", function() {
        var sel = d3.select(this);
         sel.classed("hovered",false);
         d3.selectAll("#tooltip").remove();
      });*/
  
  //Events to display extra information  
  /*svg.selectAll(".node")
  .on("mouseover", function(d,i) {
	  	var d = this.__data__;
	  	var info = svg.append("g")
	     .attr("class", "info");
	  	
	  	 info.append("rect")
	  	 .attr("x", 10)
	  	 .attr("y", 10)
	  	 .attr("rx", 10)
	  	 .attr("ry", 10)
	  	 .attr("width", 250)
		 .attr("height", 550)
		 .style("fill", "transparent")
		 .style("stroke", "grey")
		 .style("stroke-width", "4"); 
	  	
	  	 info.append("text")
	  	 .attr("id", "tooltip")
	     .attr("x", 50)
	   	 .attr("y", 40)
	     .attr("height", 100)
	     .attr("width", 200)
	     .style("font-size", "15px")
  		 .style("font-weight", "bold")
 		 .style("font-family", "Quicksand")
 		 .text(d.id);
	  	 
	  	 info.append("text")
	  	 .attr("id", "tooltip")
	     .attr("x", 50)
	   	 .attr("y", 55)
	     .attr("height", 100)
	     .attr("width", 200)
	     .style("font-size", "8px")
 		 .style("font-family", "Quicksand")
 		 .text("(click the node to view all the information)");
	  	 
	  	 info.append("text")
	  	 .attr("id", "tooltip")
	     //.attr("x", 50)
	   	 .attr("y", 75)
	     .attr("height", 100)
	     .attr("width", 200)
	     .style("font-size", "13px")
  		 .style("font-weight", "bold")
 		 .style("font-family", "Quicksand")
  		 .tspans(function(h) {
        	return d3.wordwrap(d.thematic_areas, 25);  // break line after 25 characters
    		}).attr("x", 50);
//	     .text(d.thematic_areas);
	  	 
	  	 info.append("text")
    	 .attr("id", "tooltip")
	     //.attr("x", 120)
	   	 .attr("y", 120)
	     .attr("height", 100)
	     .attr("width", 200)
	     .style("font-size", "11px")
 		 .style("font-family", "Quicksand")
 		  		 .tspans(function(h) {
        	return d3.wordwrap(d.desc, 25);  // break line after 25 characters
    		}).attr("x", 50);
	     //.text(d.desc); //Pending to be wrapped

	  	 
	  	 /*info.append("text")
	  	 .attr("id", "tooltip")
	     .attr("x", 50)
	   	 .attr("y", 250)
	     .attr("height", 100)
	     .attr("width", 200)
	     .text(d.documents);
      })
  .on("mouseout", function() {
        var sel = d3.select(this);
         sel.classed("hovered",false);
         d3.selectAll("#tooltip").remove();
      });*/
  
  simulation
      .nodes(nodes)
      .on("tick", ticked);

  simulation.force("link")
      .links(links);

  function ticked() {
	    link
	      .attr("x1", function(d) {
	        return d.source.x;
	      })
	      .attr("y1", function(d) {
	        return d.source.y;
	      })
	      .attr("x2", function(d) {
	        return d.target.x;
	      })
	      .attr("y2", function(d) {
	        return d.target.y;
	      });

	    node.attr("transform", function(d) {
	      return "translate(" + d.x + "," + d.y + ")";
	    })
	  }
  
}

function dragstarted(d) {
  if (!d3.event.active) simulation.alphaTarget(0.3).restart();
  d.fx = d.x;
  d.fy = d.y;
}

function dragged(d) {
  d.fx = d3.event.x;
  d.fy = d3.event.y;
}

function dragended(d) {
  if (!d3.event.active) simulation.alphaTarget(0);
  d.fx = null;
  d.fy = null;
}

</script></p>

<blockquote>
<hr />
<h2 class="text-align-justify">This project will study aspects of the 'smart' agenda in which practitioners from the Social and Human Sciences (SSH) offer unique and valuable insights of relevance to innovators and researchers in the ICT - LEIT[1] areas. Centred on topics concerning of users, design, digital rights and critical infrastructures, CANDID will engage SSH and ICT - LEIT researchers in ‘extended peer communications’ aiming at Responsible Innovation.</h2>
</blockquote>

</body>
